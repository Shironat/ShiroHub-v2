--chmar Services
local S = require(script.Parent.Parent.Shared.Services)
local States = require(script.Parent.Parent.Shared.States)

local ExploitsLogic = {}

--Services
local Players = S.Players
local RunService = S.RunService
local UIS = S.UIS
local VirtualUser = S.VirtualUser
local TeleportService = S.TeleportService
local Teams = S.Teams
local player = Players.LocalPlayer

--player utils
local function getChar()
    return player.Character or player.CharacterAdded:Wait()
end

local function getHumanoid()
    return getChar():WaitForChild("Humanoid")
end

local function getHRP()
    return getChar():WaitForChild("HumanoidRootPart")
end

--Criar logica
function ExploitsLogic.Reset()
    local hum = getHumanoid()
    hum.Health = 0
end

function ExploitsLogic.Rejoin()
    TeleportService:Teleport(game.PlaceId, player)
end

--WalkSpeed
local originalSpeed

function ExploitsLogic.ToggleSpeed(state)
    States.speedEnabled = state
    local hum = getHumanoid()

    if state then
        originalSpeed = originalSpeed or hum.WalkSpeed
        hum.WalkSpeed = originalSpeed * 2
    else
        if originalSpeed then
            hum.WalkSpeed = originalSpeed
            originalSpeed = nil
        end
    end
end

--JumpPower
local originalJump

local function getJump(h)
    return h.UseJumpPower and h.JumpPower or h.JumpHeight
end

local function setJump(h, v)
    if h.UseJumpPower then
        h.JumpPower = v
    else
        h.JumpHeight = v
    end
end

function ExploitsLogic.ToggleJump(state)
    States.jumpEnabled = state
    local hum = getHumanoid()

    if state then
        originalJump = originalJump or getJump(hum)
        setJump(hum, originalJump * 2)
    else
        if originalJump then
            setJump(hum, originalJump)
            originalJump = nil
        end
    end
end


--Noclip
local noclipConn

local function setNoclip(state)
    for _, v in ipairs(getChar():GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = not state
        end
    end
end

function ExploitsLogic.ToggleNoclip(state)
    States.noclipEnabled = state

    if state then
        noclipConn = RunService.Stepped:Connect(function()
            setNoclip(true)
        end)
    else
        if noclipConn then
            noclipConn:Disconnect()
            noclipConn = nil
        end
        setNoclip(false)
    end
end


--TouchFling
local flingConn

--AntiAfk
local idleConn

function ExploitsLogic.AntiAFK()
    if idleConn then return end

    idleConn = player.Idled:Connect(function()
        VirtualUser:Button2Down(Vector2.new(), workspace.CurrentCamera.CFrame)
        task.wait(1)
        VirtualUser:Button2Up(Vector2.new(), workspace.CurrentCamera.CFrame)
    end)
end

return ExploitsLogic